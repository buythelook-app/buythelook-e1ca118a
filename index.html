<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <!-- Meta tags for better WebView compatibility -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: https://ssl.gstatic.com; style-src * 'self' 'unsafe-inline'; media-src * blob: 'self' 'unsafe-inline'; img-src * data: blob: 'self' 'unsafe-inline';">
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Buy The Look</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />
    <meta property="og:image" content="/og-image.png" />
    <!-- Fallback styles to show something immediately -->
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: #f0f0f0;
      }
      #root {
        min-height: 100vh;
      }
      .loading-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
        background-color: white;
      }
      .loading-title {
        font-size: 24px;
        margin-bottom: 16px;
        color: #4a90e2;
      }
      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #4a90e2;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>

  <body>
    <!-- Root element for React app -->
    <div id="root">
      <!-- Loading screen that shows while React initializes -->
      <div class="loading-screen">
        <h2 class="loading-title">Buy The Look</h2>
        <div class="loading-spinner"></div>
        <p>Loading application...</p>
      </div>
    </div>
    
    <!-- Simple console logger for debugging -->
    <script>
      console.log('App init: HTML loaded at ' + new Date().toISOString());
      
      // Fallback error handling
      window.onerror = function(message, source, lineno, colno, error) {
        console.error('App error:', message, source, lineno, colno);
        
        // Show error on screen if initialization fails
        if (!window.appInitialized) {
          document.querySelector('.loading-screen').innerHTML += 
            '<div style="color: red; margin-top: 20px; max-width: 80%;">' + 
            'Error: ' + message + '</div>';
        }
        
        return false; // Allow other handlers to run
      };
      
      // Add handling for unhandled promise rejections
      window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled promise rejection:', event.reason);
        
        if (!window.appInitialized) {
          document.querySelector('.loading-screen').innerHTML += 
            '<div style="color: red; margin-top: 20px; max-width: 80%;">' + 
            'Promise Error: ' + (event.reason.message || event.reason) + '</div>';
        }
      });
      
      // Mark when app initializes successfully
      window.appInitialized = false;
    </script>
    
    <!-- Load Capacitor shim BEFORE main application but as a regular script not a module -->
    <script type="module">
      // Import the capacitor-shim (it will automatically initialize global objects)
      import '/src/capacitor-shim.ts';
      
      console.log('Capacitor globals initialized via import');
      
      // Check if Capacitor is available
      if (window.Capacitor) {
        console.log('Platform detection:', window.Capacitor.isNativePlatform() ? 'Native' : 'Web');
      } else {
        console.warn('Capacitor not available after shim import');
      }
    </script>
    
    <!-- Load application scripts AFTER shim is imported -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
